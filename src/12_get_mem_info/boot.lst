     1                                  ;************************************************************************
     2                                  ;	BIOSÔøΩ≈ÉÔøΩÔøΩ[ÔøΩhÔøΩÔøΩÔøΩÔøΩÔøΩ≈èÔøΩÔøΩÃÉZÔøΩNÔøΩ^
     3                                  ;	
     4                                  ;	ÔøΩvÔøΩÔøΩÔøΩOÔøΩÔøΩÔøΩÔøΩÔøΩSÔøΩÃÇÔøΩ ÇÔøΩÔøΩƒÅAÔøΩZÔøΩOÔøΩÔøΩÔøΩÔøΩÔøΩgÔøΩÃílÔøΩÔøΩ0x0000ÔøΩ∆ÇÔøΩÔøΩÔøΩB
     5                                  ;	(DS==ES==0)
     6                                  ;	
     7                                  ;************************************************************************
     8                                  
     9                                  ;************************************************************************
    10                                  ;	ÔøΩ}ÔøΩNÔøΩÔøΩ
    11                                  ;************************************************************************
    12                                  %include	"../include/define.s"
    13                              <1> BOOT_LOAD   equ     0x7C00
    14                              <1> BOOT_SIZE   equ     (1024 * 8)
    15                              <1> SECT_SIZE   equ     (512)
    16                              <1> BOOT_SECT   equ     (BOOT_SIZE / SECT_SIZE)
    17                              <1> E820_RECORD_SIZE    equ     20
    13                                  %include	"../include/macro.s"
    14                              <1> %macro  cdecl 1-*.nolist
    15                              <1> 
    16                              <1>     %rep %0 - 1
    17                              <1>         push    %{-1:-1}
    18                              <1>         %rotate -1
    19                              <1>     %endrep
    20                              <1>     %rotate -1
    21                              <1>     call    %1
    22                              <1> 
    23                              <1>     %if 1 < %0
    24                              <1>         add     sp, (__BITS__ >> 3) * (%0 - 1)
    25                              <1>     %endif
    26                              <1> %endmacro
    27                              <1> 
    28                              <1> struc drive
    29 00000000 ????                <1>     .no     resw    1
    30 00000002 ????                <1>     .cyln   resw    1
    31 00000004 ????                <1>     .head   resw    1
    32 00000006 ????                <1>     .sect   resw    1
    33                              <1> endstruc
    14                                  
    15                                  		ORG		BOOT_LOAD						; ÔøΩÔøΩÔøΩ[ÔøΩhÔøΩAÔøΩhÔøΩÔøΩÔøΩXÔøΩÔøΩÔøΩAÔøΩZÔøΩÔøΩÔøΩuÔøΩÔøΩÔøΩ…éwÔøΩÔøΩ
    16                                  
    17                                  ;************************************************************************
    18                                  ;	ÔøΩGÔøΩÔøΩÔøΩgÔøΩÔøΩÔøΩ|ÔøΩCÔøΩÔøΩÔøΩg
    19                                  ;************************************************************************
    20                                  entry:
    21                                  		;---------------------------------------
    22                                  		; BPB(BIOS Parameter Block)
    23                                  		;---------------------------------------
    24 00000000 EB58                    		jmp		ipl								; IPLÔøΩ÷ÉWÔøΩÔøΩÔøΩÔøΩÔøΩv
    25 00000002 90<rep 58h>             		times	90 - ($ - $$) db 0x90			; 
    26                                  
    27                                  		;---------------------------------------
    28                                  		; IPL(Initial Program Loader)
    29                                  		;---------------------------------------
    30                                  ipl:
    31 0000005A FA                      		cli										; // ÔøΩÔøΩÔøΩËçûÔøΩ›ã÷é~
    32                                  
    33 0000005B B80000                  		mov		ax, 0x0000						; AX = 0x0000;
    34 0000005E 8ED8                    		mov		ds, ax							; DS = 0x0000;
    35 00000060 8EC0                    		mov		es, ax							; ES = 0x0000;
    36 00000062 8ED0                    		mov		ss, ax							; SS = 0x0000;
    37 00000064 BC007C                  		mov		sp, BOOT_LOAD					; SP = 0x7C00;
    38                                  
    39 00000067 FB                      		sti										; // ÔøΩÔøΩÔøΩËçûÔøΩ›ãÔøΩÔøΩÔøΩ
    40                                  
    41 00000068 8816[B800]              		mov		[BOOT + drive.no], dl			; ÔøΩuÔøΩ[ÔøΩgÔøΩhÔøΩÔøΩÔøΩCÔøΩuÔøΩÔøΩ€ëÔøΩ
    42                                  
    43                                  		;---------------------------------------
    44                                  		; ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ\ÔøΩÔøΩ
    45                                  		;---------------------------------------
    46 0000006C 68[9900]E84E0083C4-     		cdecl	puts, .s0						; puts(.s0);
    46 00000074 02                 
    47                                  
    48                                  		;---------------------------------------
    49                                  		; ÔøΩcÔøΩÔøΩÃÉZÔøΩNÔøΩ^ÔøΩÔøΩSÔøΩƒì«Ç›çÔøΩÔøΩÔøΩ
    50                                  		;---------------------------------------
    51 00000075 BB0F00                  		mov		bx, BOOT_SECT - 1				; BX = ÔøΩcÔøΩÔøΩÃÉuÔøΩ[ÔøΩgÔøΩZÔøΩNÔøΩ^ÔøΩÔøΩ;
    52 00000078 B9007E                  		mov		cx, BOOT_LOAD + SECT_SIZE		; CX = ÔøΩÔøΩÔøΩÃÉÔøΩÔøΩ[ÔøΩhÔøΩAÔøΩhÔøΩÔøΩÔøΩX;
    53                                  
    54 0000007B 515368[B800]E89B00-     		cdecl	read_chs, BOOT, bx, cx			; AX = read_chs(.chs, bx, cx);
    54 00000083 83C406             
    55                                  
    56 00000086 39D8                    		cmp		ax, bx							; if (AX != ÔøΩcÔøΩÔøΩÃÉZÔøΩNÔøΩ^ÔøΩÔøΩ)
    57 00000088 740C                    .10Q:	jz		.10E							; {
    58 0000008A 68[A600]E8300083C4-     .10T:	cdecl	puts, .e0						;   puts(.e0);
    58 00000092 02                 
    59 00000093 E84900                  		call	reboot							;   reboot(); // ÔøΩƒãNÔøΩÔøΩ
    60                                  .10E:											; }
    61                                  
    62                                  		;---------------------------------------
    63                                  		; ÔøΩÔøΩÔøΩÃÉXÔøΩeÔøΩ[ÔøΩWÔøΩ÷à⁄çs
    64                                  		;---------------------------------------
    65 00000096 E9F904                  		jmp		stage_2							; ÔøΩuÔøΩ[ÔøΩgÔøΩÔøΩÔøΩÔøΩÔøΩÃëÔøΩ2ÔøΩXÔøΩeÔøΩ[ÔøΩW
    66                                  
    67                                  		;---------------------------------------
    68                                  		; ÔøΩfÔøΩ[ÔøΩ^
    69                                  		;---------------------------------------
    70 00000099 426F6F74696E672E2E-     .s0		db	"Booting...", 0x0A, 0x0D, 0
    70 000000A2 2E0A0D00           
    71 000000A6 4572726F723A736563-     .e0		db	"Error:sector read", 0
    71 000000AF 746F72207265616400 
    72                                  
    73                                  ;************************************************************************
    74                                  ;	ÔøΩuÔøΩ[ÔøΩgÔøΩhÔøΩÔøΩÔøΩCÔøΩuÔøΩ…ä÷ÇÔøΩÔøΩÔøΩÔøΩÔøΩ
    75                                  ;************************************************************************
    76                                  ALIGN 2, db 0
    77                                  BOOT:											; ÔøΩuÔøΩ[ÔøΩgÔøΩhÔøΩÔøΩÔøΩCÔøΩuÔøΩ…ä÷ÇÔøΩÔøΩÔøΩÔøΩÔøΩ
    78                                  	istruc	drive
    79 000000B8 0000                    		at	drive.no,		dw	0				; ÔøΩhÔøΩÔøΩÔøΩCÔøΩuÔøΩ‘çÔøΩ
    80 000000BA 0000                    		at	drive.cyln,		dw	0				; C:ÔøΩVÔøΩÔøΩÔøΩÔøΩÔøΩ_
    81 000000BC 0000                    		at	drive.head,		dw	0				; H:ÔøΩwÔøΩbÔøΩh
    82 000000BE 0200                    		at	drive.sect,		dw	2				; S:ÔøΩZÔøΩNÔøΩ^
    83                                  	iend
    84                                  
    85                                  ;************************************************************************
    86                                  ;	ÔøΩÔøΩÔøΩWÔøΩÔøΩÔøΩ[ÔøΩÔøΩ
    87                                  ;************************************************************************
    88                                  %include	"../modules/real/puts.s"
    89                              <1> puts:
    90 000000C0 55                  <1>     push    bp
    91 000000C1 89E5                <1>     mov     bp, sp
    92 000000C3 50                  <1>     push    ax
    93 000000C4 53                  <1>     push    bx
    94 000000C5 56                  <1>     push    si
    95                              <1> 
    96 000000C6 8B7604              <1>     mov     si, [bp + 4]
    97                              <1> 
    98 000000C9 B40E                <1>     mov     ah, 0x0E
    99 000000CB BB0000              <1>     mov     bx, 0x0000
   100 000000CE FC                  <1>     cld
   101                              <1> 
   102                              <1> .10L:
   103 000000CF AC                  <1>     lodsb
   104 000000D0 3C00                <1>     cmp     al, 0
   105 000000D2 7404                <1>     je      .10E
   106                              <1> 
   107 000000D4 CD10                <1>     int     0x10
   108 000000D6 EBF7                <1>     jmp     .10L
   109                              <1> 
   110                              <1> .10E:
   111 000000D8 5E                  <1>     pop     si
   112 000000D9 5B                  <1>     pop     bx
   113 000000DA 58                  <1>     pop     ax
   114                              <1> 
   115 000000DB 89EC                <1>     mov     sp, bp
   116 000000DD 5D                  <1>     pop     bp
   117                              <1> 
   118 000000DE C3                  <1>     ret
    89                                  %include	"../modules/real/reboot.s"
    90                              <1> reboot:
    91 000000DF 68[FB00]E8DBFF83C4- <1>     cdecl   puts, .s0
    91 000000E7 02                  <1>
    92                              <1> 
    93                              <1> .10L:
    94 000000E8 B410                <1>     mov     ah, 0x10
    95 000000EA CD16                <1>     int     0x16
    96                              <1> 
    97 000000EC 3C20                <1>     cmp     al, ' '
    98 000000EE 75F8                <1>     jne     .10L
    99                              <1> 
   100 000000F0 68[1901]E8CAFF83C4- <1>     cdecl   puts, .s1
   100 000000F8 02                  <1>
   101                              <1> 
   102 000000F9 CD19                <1>     int     0x19
   103                              <1> 
   104 000000FB 0A0D50757368205370- <1> .s0     db  0x0A, 0x0D, "Push Space key to reboot...", 0
   104 00000104 616365206B65792074- <1>
   104 0000010D 6F207265626F6F742E- <1>
   104 00000116 2E2E00              <1>
   105 00000119 0A0D0A0D00          <1> .s1     db  0x0A, 0x0D, 0x0A, 0x0D, 0
    90                                  %include	"../modules/real/read_chs.s"
    91                              <1> read_chs:
    92 0000011E 55                  <1>     push    bp
    93 0000011F 89E5                <1>     mov     bp, sp
    94 00000121 6A03                <1>     push    3
    95 00000123 6A00                <1>     push    0
    96                              <1> 
    97 00000125 53                  <1>     push    bx
    98 00000126 51                  <1>     push    cx
    99 00000127 52                  <1>     push    dx
   100 00000128 06                  <1>     push    es
   101 00000129 56                  <1>     push    si
   102                              <1> 
   103 0000012A 8B7604              <1>     mov     si, [bp + 4]
   104                              <1> 
   105 0000012D 8A6C02              <1>     mov     ch, [si + drive.cyln + 0]
   106 00000130 8A4C03              <1>     mov     cl, [si + drive.cyln + 1]
   107 00000133 C0E106              <1>     shl     cl, 6
   108 00000136 0A4C06              <1>     or      cl, [si + drive.sect]
   109                              <1> 
   110 00000139 8A7404              <1>     mov     dh, [si + drive.head]
   111 0000013C 8A14                <1>     mov     dl, [si + 0]
   112 0000013E B80000              <1>     mov     ax, 0x0000
   113 00000141 8EC0                <1>     mov     es, ax
   114 00000143 8B5E08              <1>     mov     bx, [bp + 8]
   115                              <1> 
   116                              <1> .10L:
   117 00000146 B402                <1>     mov     ah, 0x02
   118 00000148 8A4606              <1>     mov     al, [bp + 6]
   119                              <1> 
   120 0000014B CD13                <1>     int     0x13
   121 0000014D 7304                <1>     jnc     .11E
   122                              <1> 
   123 0000014F B000                <1>     mov     al, 0
   124 00000151 EB0C                <1>     jmp     .10E
   125                              <1> .11E:
   126 00000153 3C00                <1>     cmp     al, 0
   127 00000155 7508                <1>     jne     .10E
   128                              <1> 
   129 00000157 B80000              <1>     mov     ax, 0
   130 0000015A FF4EFE              <1>     dec     word [bp - 2]
   131 0000015D 75E7                <1>     jnz     .10L
   132                              <1> 
   133                              <1> .10E:
   134 0000015F B400                <1>     mov     ah, 0
   135                              <1> 
   136 00000161 5E                  <1>     pop     si
   137 00000162 07                  <1>     pop     es
   138 00000163 5A                  <1>     pop     dx
   139 00000164 59                  <1>     pop     cx
   140 00000165 5B                  <1>     pop     bx
   141                              <1> 
   142 00000166 89EC                <1>     mov     sp, bp
   143 00000168 5D                  <1>     pop     bp
   144 00000169 C3                  <1>     ret
    91                                  
    92                                  ;************************************************************************
    93                                  ;	ÔøΩuÔøΩ[ÔøΩgÔøΩtÔøΩÔøΩÔøΩOÔøΩiÔøΩÊì™512ÔøΩoÔøΩCÔøΩgÔøΩÃèIÔøΩÔøΩÔøΩj
    94                                  ;************************************************************************
    95 0000016A 00<rep 94h>             		times	510 - ($ - $$) db 0x00
    96 000001FE 55AA                    		db	0x55, 0xAA
    97                                  
    98                                  ;************************************************************************
    99                                  ;	ÔøΩÔøΩÔøΩAÔøΩÔøΩÔøΩÔøΩÔøΩ[ÔøΩhÔøΩÔøΩÔøΩ…éÊìæÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ
   100                                  ;************************************************************************
   101                                  FONT:											; ÔøΩtÔøΩHÔøΩÔøΩÔøΩg
   102 00000200 0000                    .seg:	dw	0
   103 00000202 0000                    .off:	dw	0
   104                                  ACPI_DATA:										; ACPI data
   105 00000204 00000000                .adr:	dd	0									; ACPI data address
   106 00000208 00000000                .len:	dd	0									; ACPI data length
   107                                  
   108                                  ;************************************************************************
   109                                  ;	ÔøΩÔøΩÔøΩWÔøΩÔøΩÔøΩ[ÔøΩÔøΩÔøΩiÔøΩÊì™512ÔøΩoÔøΩCÔøΩgÔøΩ»ç~ÔøΩ…îzÔøΩuÔøΩj
   110                                  ;************************************************************************
   111                                  %include	"../modules/real/itoa.s"
   112                              <1> itoa:
   113 0000020C 55                  <1>     push    bp
   114 0000020D 89E5                <1>     mov     bp, sp
   115                              <1>     
   116 0000020F 50                  <1>     push    ax
   117 00000210 53                  <1>     push    bx
   118 00000211 51                  <1>     push    cx
   119 00000212 52                  <1>     push    dx
   120 00000213 56                  <1>     push    si
   121 00000214 57                  <1>     push    di
   122                              <1> 
   123 00000215 8B4604              <1>     mov     ax, [bp + 4]
   124 00000218 8B7606              <1>     mov     si, [bp + 6]
   125 0000021B 8B4E08              <1>     mov     cx, [bp + 8]
   126                              <1> 
   127 0000021E 89F7                <1>     mov     di, si
   128 00000220 01CF                <1>     add     di, cx
   129 00000222 4F                  <1>     dec     di
   130                              <1> 
   131 00000223 8B5E0C              <1>     mov     bx, word [bp + 12]
   132                              <1> 
   133 00000226 F7C30100            <1>     test    bx, 0b0001
   134                              <1> .10Q:
   135 0000022A 7408                <1>     je      .10E
   136 0000022C 83F800              <1>     cmp     ax, 0
   137                              <1> .12Q:
   138 0000022F 7D03                <1>     jge     .12E
   139 00000231 83CB02              <1>     or      bx, 0b0010
   140                              <1> .12E:
   141                              <1> .10E:
   142                              <1> 
   143 00000234 F7C30200            <1>     test    bx, 0b0010
   144                              <1> .20Q:
   145 00000238 7410                <1>     je      .20E
   146 0000023A 83F800              <1>     cmp     ax, 0
   147                              <1> .22Q:
   148 0000023D 7D07                <1>     jge     .22F
   149 0000023F F7D8                <1>     neg     ax
   150 00000241 C6042D              <1>     mov     [si], byte '-'
   151 00000244 EB03                <1>     jmp     .22E
   152                              <1> .22F:
   153 00000246 C6042B              <1>     mov     [si], byte '+'
   154                              <1> .22E:
   155 00000249 49                  <1>     dec     cx
   156                              <1> .20E:
   157 0000024A 8B5E0A              <1>     mov     bx, [bp + 10]
   158                              <1> .30L:
   159 0000024D BA0000              <1>     mov     dx, 0
   160 00000250 F7F3                <1>     div     bx
   161 00000252 89D6                <1>     mov     si, dx
   162 00000254 8A94[7C02]          <1>     mov     dl, byte [.ascii+si]
   163 00000258 8815                <1>     mov     [di], dl
   164 0000025A 4F                  <1>     dec     di
   165                              <1> 
   166 0000025B 83F800              <1>     cmp     ax, 0
   167 0000025E E0ED                <1>     loopnz  .30L
   168                              <1> .30E:
   169                              <1> 
   170 00000260 83F900              <1>     cmp     cx, 0
   171                              <1> .40Q:
   172 00000263 740D                <1>     je      .40E
   173 00000265 B020                <1>     mov     al, ' '
   174 00000267 837E0C04            <1>     cmp     [bp + 12], word 0b0100
   175                              <1> .42Q:
   176 0000026B 7502                <1>     jne     .42E
   177 0000026D B030                <1>     mov     al, '0'
   178                              <1> .42E:
   179 0000026F FD                  <1>     std
   180 00000270 F3AA                <1>     rep     stosb
   181                              <1> .40E:
   182 00000272 5F                  <1>     pop     di
   183 00000273 5E                  <1>     pop     si
   184 00000274 5A                  <1>     pop     dx
   185 00000275 59                  <1>     pop     cx
   186 00000276 5B                  <1>     pop     bx
   187 00000277 58                  <1>     pop     ax
   188                              <1> 
   189 00000278 89EC                <1>     mov     sp, bp
   190 0000027A 5D                  <1>     pop     bp
   191                              <1> 
   192 0000027B C3                  <1>     ret
   193                              <1> 
   194 0000027C 303132333435363738- <1> .ascii  db  "0123456789ABCDEF"
   194 00000285 39414243444546      <1>
   112                                  %include	"../modules/real/get_drive_param.s"
   113                              <1> get_drive_param:
   114 0000028C 55                  <1>     push    bp
   115 0000028D 89E5                <1>     mov     bp, sp
   116                              <1> 
   117 0000028F 53                  <1>     push    bx
   118 00000290 51                  <1>     push    cx
   119 00000291 06                  <1>     push    es
   120 00000292 56                  <1>     push    si
   121 00000293 57                  <1>     push    di
   122                              <1> 
   123 00000294 8B7604              <1>     mov     si, [bp + 4]
   124                              <1> 
   125 00000297 B80000              <1>     mov     ax, 0
   126 0000029A 8EC0                <1>     mov     es, ax
   127 0000029C 89C7                <1>     mov     di, ax
   128                              <1> 
   129 0000029E B408                <1>     mov     ah, 8
   130 000002A0 8A14                <1>     mov     dl, [si + drive.no]
   131 000002A2 CD13                <1>     int     0x13
   132                              <1> .10Q:
   133 000002A4 721B                <1>     jc      .10F
   134                              <1> .10T:
   135 000002A6 88C8                <1>     mov     al, cl
   136 000002A8 83E03F              <1>     and     ax, 0x3F
   137                              <1> 
   138 000002AB C0E906              <1>     shr     cl, 6
   139 000002AE C1C908              <1>     ror     cx, 8
   140 000002B1 41                  <1>     inc     cx
   141                              <1> 
   142 000002B2 0FB6DE              <1>     movzx   bx, dh
   143 000002B5 43                  <1>     inc     bx
   144                              <1> 
   145 000002B6 894C02              <1>     mov     [si + drive.cyln], cx
   146 000002B9 895C04              <1>     mov     [si + drive.head], bx
   147 000002BC 894406              <1>     mov     [si + drive.sect], ax
   148                              <1> 
   149 000002BF EB03                <1>     jmp     .10E
   150                              <1> .10F:
   151 000002C1 B80000              <1>     mov     ax, 0
   152                              <1> .10E:
   153 000002C4 5F                  <1>     pop     di
   154 000002C5 5E                  <1>     pop     si
   155 000002C6 07                  <1>     pop     es
   156 000002C7 59                  <1>     pop     cx
   157 000002C8 5B                  <1>     pop     bx
   158                              <1> 
   159 000002C9 89EC                <1>     mov     sp, bp
   160 000002CB 5D                  <1>     pop     bp
   161 000002CC C3                  <1>     ret
   113                                  %include	"../modules/real/get_font_adr.s"
   114                              <1> get_font_adr:
   115 000002CD 55                  <1>     push    bp
   116 000002CE 89E5                <1>     mov     bp, sp
   117                              <1> 
   118 000002D0 50                  <1>     push    ax
   119 000002D1 53                  <1>     push    bx
   120 000002D2 56                  <1>     push    si
   121 000002D3 06                  <1>     push    es
   122 000002D4 55                  <1>     push    bp
   123                              <1> 
   124 000002D5 8B7604              <1>     mov     si, [bp + 4]
   125                              <1> 
   126 000002D8 B83011              <1>     mov     ax, 0x1130
   127 000002DB B706                <1>     mov     bh, 0x06
   128 000002DD CD10                <1>     int     10h
   129                              <1> 
   130 000002DF 8C04                <1>     mov     [si + 0], es
   131 000002E1 896C02              <1>     mov     [si + 2], bp
   132                              <1> 
   133 000002E4 5D                  <1>     pop     bp
   134 000002E5 07                  <1>     pop     es
   135 000002E6 5E                  <1>     pop     si
   136 000002E7 5B                  <1>     pop     bx
   137 000002E8 58                  <1>     pop     ax
   138                              <1> 
   139 000002E9 89EC                <1>     mov     sp, bp
   140 000002EB 5D                  <1>     pop     bp
   141                              <1> 
   142 000002EC C3                  <1>     ret
   114                                  %include	"../modules/real/get_mem_info.s"
   115                              <1> get_mem_info:
   116 000002ED 6650                <1>     push    eax
   117 000002EF 6653                <1>     push    ebx
   118 000002F1 6651                <1>     push    ecx
   119 000002F3 6652                <1>     push    edx
   120 000002F5 56                  <1>     push    si
   121 000002F6 57                  <1>     push    di
   122 000002F7 55                  <1>     push    bp
   123                              <1> 
   124 000002F8 68[8C03]E8C2FD83C4- <1>     cdecl   puts, .s0
   124 00000300 02                  <1>
   125                              <1> 
   126 00000301 BD0000              <1>     mov     bp, 0
   127 00000304 66BB00000000        <1>     mov     ebx, 0
   128                              <1> 
   129                              <1> .10L:
   130 0000030A 66B820E80000        <1>     mov     eax, 0x0000E820
   131 00000310 66B914000000        <1>     mov     ecx, E820_RECORD_SIZE
   132 00000316 66BA50414D53        <1>     mov     edx, 'PAMS'
   133 0000031C BF[1804]            <1>     mov     di, .b0
   134 0000031F CD15                <1>     int     0x15
   135                              <1> 
   136 00000321 663D50414D53        <1>     cmp     eax, 'PAMS'
   137 00000327 7402                <1>     je      .12E
   138 00000329 EB4C                <1>     jmp     .10E
   139                              <1> .12E:
   140 0000032B 7302                <1>     jnc     .14E
   141 0000032D EB48                <1>     jmp     .10E
   142                              <1> .14E:
   143 0000032F 57E8F90083C402      <1>     cdecl   put_mem_info, di
   144                              <1> 
   145 00000336 668B4510            <1>     mov     eax, [di + 16]
   146 0000033A 6683F803            <1>     cmp     eax, 3
   147 0000033E 750F                <1>     jne     .15E
   148                              <1> 
   149 00000340 668B05              <1>     mov     eax, [di + 0]
   150 00000343 66A3[0402]          <1>     mov     [ACPI_DATA.adr], eax
   151                              <1> 
   152 00000347 668B4508            <1>     mov     eax, [di + 8]
   153 0000034B 66A3[0802]          <1>     mov     [ACPI_DATA.len], eax
   154                              <1> 
   155                              <1> .15E:
   156 0000034F 6683FB00            <1>     cmp     ebx, 0
   157 00000353 741C                <1>     jz      .16E
   158                              <1> 
   159 00000355 45                  <1>     inc     bp
   160 00000356 83E507              <1>     and     bp, 0x07
   161 00000359 7516                <1>     jnz     .16E
   162                              <1> 
   163 0000035B 68[FF03]E85FFD83C4- <1>     cdecl   puts, .s2
   163 00000363 02                  <1>
   164                              <1> 
   165 00000364 B410                <1>     mov     ah, 0x10
   166 00000366 CD16                <1>     int     0x16
   167                              <1> 
   168 00000368 68[0904]E852FD83C4- <1>     cdecl   puts, .s3
   168 00000370 02                  <1>
   169                              <1> 
   170                              <1> .16E:
   171 00000371 6683FB00            <1>     cmp     ebx, 0
   172 00000375 7593                <1>     jne     .10L
   173                              <1> 
   174                              <1> .10E:
   175 00000377 68[CF03]E843FD83C4- <1>     cdecl   puts, .s1
   175 0000037F 02                  <1>
   176                              <1> 
   177 00000380 5D                  <1>     pop     bp
   178 00000381 5F                  <1>     pop     di
   179 00000382 5E                  <1>     pop     si
   180 00000383 665A                <1>     pop     edx
   181 00000385 6659                <1>     pop     ecx
   182 00000387 665B                <1>     pop     ebx
   183 00000389 6658                <1>     pop     eax
   184                              <1> 
   185 0000038B C3                  <1>     ret
   186                              <1> 
   187                              <1> 
   188 0000038C 2045383230204D656D- <1> .s0 db " E820 Memory Map:", 0x0A, 0x0D
   188 00000395 6F7279204D61703A0A- <1>
   188 0000039E 0D                  <1>
   189 0000039F 20426173655F5F5F5F- <1>     db " Base_____________ Length___________ Type____", 0x0A, 0x0D, 0
   189 000003A8 5F5F5F5F5F5F5F5F5F- <1>
   189 000003B1 204C656E6774685F5F- <1>
   189 000003BA 5F5F5F5F5F5F5F5F5F- <1>
   189 000003C3 20547970655F5F5F5F- <1>
   189 000003CC 0A0D00              <1>
   190 000003CF 202D2D2D2D2D2D2D2D- <1> .s1 db  " ----------------- ----------------- --------", 0x0A, 0x0D, 0
   190 000003D8 2D2D2D2D2D2D2D2D2D- <1>
   190 000003E1 202D2D2D2D2D2D2D2D- <1>
   190 000003EA 2D2D2D2D2D2D2D2D2D- <1>
   190 000003F3 202D2D2D2D2D2D2D2D- <1>
   190 000003FC 0A0D00              <1>
   191 000003FF 3C6D6F72652E2E2E3E- <1> .s2 db  "<more...>", 0
   191 00000408 00                  <1>
   192 00000409 0D2020202020202020- <1> .s3 db  0x0D, "         ", 0x0D, 0
   192 00000412 200D00              <1>
   193                              <1> 
   194                              <1> 
   195 00000415 00<rep 3h>          <1> ALIGN 4, db 0
   196 00000418 00<rep 14h>         <1> .b0:    times E820_RECORD_SIZE db 0
   197                              <1> 
   198                              <1> 
   199                              <1> 
   200                              <1> put_mem_info:
   201 0000042C 55                  <1>     push    bp
   202 0000042D 89E5                <1>     mov     bp, sp
   203                              <1> 
   204 0000042F 53                  <1>     push    bx
   205 00000430 56                  <1>     push    si
   206                              <1> 
   207 00000431 8B7604              <1>     mov     si, [bp + 4]
   208                              <1> 
   209 00000434 6A046A106A0468-     <1>     cdecl   itoa, word [si + 6], .p2+0, 4, 16, 0b0100
   209 0000043B [0B05]FF7406E8C9FD- <1>
   209 00000443 83C40A              <1>
   210 00000446 6A046A106A0468-     <1>     cdecl   itoa, word [si + 4], .p2+4, 4, 16, 0b0100
   210 0000044D [0F05]FF7404E8B7FD- <1>
   210 00000455 83C40A              <1>
   211 00000458 6A046A106A0468-     <1>     cdecl   itoa, word [si + 2], .p3+0, 4, 16, 0b0100
   211 0000045F [1405]FF7402E8A5FD- <1>
   211 00000467 83C40A              <1>
   212 0000046A 6A046A106A0468-     <1>     cdecl   itoa, word [si + 0], .p3+4, 4, 16, 0b0100
   212 00000471 [1805]FF34E894FD83- <1>
   212 00000479 C40A                <1>
   213                              <1> 
   214 0000047B 6A046A106A0468-     <1>     cdecl   itoa, word [si + 14], .p4+0, 4, 16, 0b0100
   214 00000482 [1C05]FF740EE882FD- <1>
   214 0000048A 83C40A              <1>
   215 0000048D 6A046A106A0468-     <1>     cdecl   itoa, word [si + 12], .p4+4, 4, 16, 0b0100
   215 00000494 [2005]FF740CE870FD- <1>
   215 0000049C 83C40A              <1>
   216 0000049F 6A046A106A0468-     <1>     cdecl   itoa, word [si + 10], .p5+0, 4, 16, 0b0100
   216 000004A6 [2505]FF740AE85EFD- <1>
   216 000004AE 83C40A              <1>
   217 000004B1 6A046A106A0468-     <1>     cdecl   itoa, word [si +  8], .p5+4, 4, 16, 0b0100
   217 000004B8 [2905]FF7408E84CFD- <1>
   217 000004C0 83C40A              <1>
   218                              <1> 
   219 000004C3 6A046A106A0468-     <1>     cdecl   itoa, word [si + 18], .p6+0, 4, 16, 0b0100
   219 000004CA [2D05]FF7412E83AFD- <1>
   219 000004D2 83C40A              <1>
   220 000004D5 6A046A106A0468-     <1>     cdecl   itoa, word [si + 16], .p6+4, 4, 16, 0b0100
   220 000004DC [3105]FF7410E828FD- <1>
   220 000004E4 83C40A              <1>
   221                              <1> 
   222 000004E7 68[0A05]E8D3FB83C4- <1>     cdecl   puts, .s1
   222 000004EF 02                  <1>
   223                              <1> 
   224 000004F0 8B5C10              <1>     mov     bx, [si + 16]
   225 000004F3 83E307              <1>     and     bx, 0x07
   226 000004F6 D1E3                <1>     shl     bx, 1
   227 000004F8 81C3[8A05]          <1>     add     bx, .t0
   228 000004FC FF37E8BFFB83C402    <1>     cdecl   puts, word [bx]
   229                              <1> 
   230 00000504 5E                  <1>     pop     si
   231 00000505 5B                  <1>     pop     bx
   232                              <1> 
   233 00000506 89EC                <1>     mov     sp, bp
   234 00000508 5D                  <1>     pop     bp
   235                              <1> 
   236 00000509 C3                  <1>     ret
   237                              <1> 
   238                              <1> 
   239                              <1> 
   240 0000050A 20                  <1> .s1 db  " "
   241 0000050B 5A5A5A5A5A5A5A5A5F  <1> .p2 db  "ZZZZZZZZ_"
   242 00000514 5A5A5A5A5A5A5A5A    <1> .p3 db  "ZZZZZZZZ"
   243 0000051C 5A5A5A5A5A5A5A5A5F  <1> .p4 db  "ZZZZZZZZ_"
   244 00000525 5A5A5A5A5A5A5A5A    <1> .p5 db  "ZZZZZZZZ"
   245 0000052D 5A5A5A5A5A5A5A5A00  <1> .p6 db  "ZZZZZZZZ", 0
   246                              <1> 
   247 00000536 2028556E6B6E6F776E- <1> .s4 db  " (Unknown)", 0x0A, 0x0D, 0
   247 0000053F 290A0D00            <1>
   248 00000543 2028757361626C6529- <1> .s5 db  " (usable)", 0x0A, 0x0D, 0
   248 0000054C 0A0D00              <1>
   249 0000054F 202872657365727665- <1> .s6 db  " (reserved)", 0x0A, 0x0D, 0
   249 00000558 64290A0D00          <1>
   250 0000055D 202841435049206461- <1> .s7 db  " (ACPI data)", 0x0A, 0x0D, 0
   250 00000566 7461290A0D00        <1>
   251 0000056C 202841435049204E56- <1> .s8 db  " (ACPI NVS)", 0x0A, 0x0D, 0
   251 00000575 53290A0D00          <1>
   252 0000057A 2028626164206D656D- <1> .s9 db  " (bad memory)", 0x0A, 0x0D, 0
   252 00000583 6F7279290A0D00      <1>
   253                              <1> 
   254 0000058A [36][43][4F][5D]-   <1> .t0 db  .s4, .s5, .s6, .s7, .s8, .s9, .s4, .s4
   254 0000058E [6C][7A][36][36]    <1>
   115                                  
   116                                  ;************************************************************************
   117                                  ;	ÔøΩuÔøΩ[ÔøΩgÔøΩÔøΩÔøΩÔøΩÔøΩÃëÔøΩ2ÔøΩXÔøΩeÔøΩ[ÔøΩW
   118                                  ;************************************************************************
   119                                  stage_2:
   120                                  		;---------------------------------------
   121                                  		; ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ\ÔøΩÔøΩ
   122                                  		;---------------------------------------
   123 00000592 68[0C06]E828FB83C4-     		cdecl	puts, .s0						; puts(.s0);
   123 0000059A 02                 
   124                                  
   125                                  		;---------------------------------------
   126                                  		; ÔøΩhÔøΩÔøΩÔøΩCÔøΩuÔøΩÔøΩÔøΩÔøΩÔøΩÊìæ
   127                                  		;---------------------------------------
   128 0000059B 68[B800]E8EBFC83C4-     		cdecl	get_drive_param, BOOT			; get_drive_param(DX, BOOT.CYLN);
   128 000005A3 02                 
   129 000005A4 83F800                  		cmp		ax, 0							; if (0 == AX)
   130 000005A7 750C                    .10Q:	jne		.10E							; {
   131 000005A9 68[4306]E811FB83C4-     .10T:	cdecl	puts, .e0						;   puts(.e0);
   131 000005B1 02                 
   132 000005B2 E82AFB                  		call	reboot							;   reboot(); // ÔøΩƒãNÔøΩÔøΩ
   133                                  .10E:											; }
   134                                  
   135                                  		;---------------------------------------
   136                                  		; ÔøΩhÔøΩÔøΩÔøΩCÔøΩuÔøΩÔøΩÔøΩÔøΩ\ÔøΩÔøΩ
   137                                  		;---------------------------------------
   138 000005B5 A1[B800]                		mov		ax, [BOOT + drive.no]			; AX = ÔøΩuÔøΩ[ÔøΩgÔøΩhÔøΩÔøΩÔøΩCÔøΩu;
   139 000005B8 6A046A106A0268-         		cdecl	itoa, ax, .p1, 2, 16, 0b0100	; 
   139 000005BF [2406]50E847FC83C4-
   139 000005C7 0A                 
   140 000005C8 A1[BA00]                		mov		ax, [BOOT + drive.cyln]			; 
   141 000005CB 6A046A106A0468-         		cdecl	itoa, ax, .p2, 4, 16, 0b0100	; 
   141 000005D2 [2C06]50E834FC83C4-
   141 000005DA 0A                 
   142 000005DB A1[BC00]                		mov		ax, [BOOT + drive.head]			; AX = ÔøΩwÔøΩbÔøΩhÔøΩÔøΩ;
   143 000005DE 6A046A106A0268-         		cdecl	itoa, ax, .p3, 2, 16, 0b0100	; 
   143 000005E5 [3606]50E821FC83C4-
   143 000005ED 0A                 
   144 000005EE A1[BE00]                		mov		ax, [BOOT + drive.sect]			; AX = ÔøΩgÔøΩÔøΩÔøΩbÔøΩNÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÃÉZÔøΩNÔøΩ^ÔøΩÔøΩ;
   145 000005F1 6A046A106A0268-         		cdecl	itoa, ax, .p4, 2, 16, 0b0100	; 
   145 000005F8 [3E06]50E80EFC83C4-
   145 00000600 0A                 
   146 00000601 68[1B06]E8B9FA83C4-     		cdecl	puts, .s1
   146 00000609 02                 
   147                                  
   148                                  		;---------------------------------------
   149                                  		; ÔøΩÔøΩÔøΩÃÉXÔøΩeÔøΩ[ÔøΩWÔøΩ÷à⁄çs
   150                                  		;---------------------------------------
   151 0000060A EB52                    		jmp		stage_3rd						; ÔøΩÔøΩÔøΩÃÉXÔøΩeÔøΩ[ÔøΩWÔøΩ÷à⁄çs
   152                                  
   153                                  		;---------------------------------------
   154                                  		; ÔøΩfÔøΩ[ÔøΩ^
   155                                  		;---------------------------------------
   156 0000060C 326E64207374616765-     .s0		db	"2nd stage...", 0x0A, 0x0D, 0
   156 00000615 2E2E2E0A0D00       
   157                                  
   158 0000061B 2044726976653A3078      .s1		db	" Drive:0x"
   159 00000624 20202C20433A3078        .p1		db	"  , C:0x"
   160 0000062C 202020202C20483A30-     .p2		db	"    , H:0x"
   160 00000635 78                 
   161 00000636 20202C20533A3078        .p3		db	"  , S:0x"
   162 0000063E 20200A0D00              .p4		db	"  ", 0x0A, 0x0D, 0
   163                                  
   164 00000643 43616E277420676574-     .e0		db	"Can't get drive parameter.", 0
   164 0000064C 206472697665207061-
   164 00000655 72616D657465722E00 
   165                                  
   166                                  ;************************************************************************
   167                                  ;	ÔøΩuÔøΩ[ÔøΩgÔøΩÔøΩÔøΩÔøΩÔøΩÃëÔøΩ3ÔøΩXÔøΩeÔøΩ[ÔøΩW
   168                                  ;************************************************************************
   169                                  stage_3rd:
   170                                  		;---------------------------------------
   171                                  		; ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ\ÔøΩÔøΩ
   172                                  		;---------------------------------------
   173 0000065E 68[DB06]E85CFA83C4-     		cdecl	puts, .s0
   173 00000666 02                 
   174                                  
   175                                  		;---------------------------------------
   176                                  		; ÔøΩvÔøΩÔøΩÔøΩeÔøΩNÔøΩgÔøΩÔøΩÔøΩ[ÔøΩhÔøΩ≈égÔøΩpÔøΩÔøΩÔøΩÔøΩtÔøΩHÔøΩÔøΩÔøΩgÔøΩÕÅA
   177                                  		; BIOSÔøΩ…ìÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÍÇΩÔøΩÔøΩÔøΩÃÇó¨ópÔøΩÔøΩÔøΩÔøΩ
   178                                  		;---------------------------------------
   179 00000667 68[0002]E860FC83C4-     		cdecl	get_font_adr, FONT				; // BIOSÔøΩÃÉtÔøΩHÔøΩÔøΩÔøΩgÔøΩAÔøΩhÔøΩÔøΩÔøΩXÔøΩÔøΩÔøΩÊìæ
   179 0000066F 02                 
   180                                  
   181                                  		;---------------------------------------
   182                                  		; ÔøΩtÔøΩHÔøΩÔøΩÔøΩgÔøΩAÔøΩhÔøΩÔøΩÔøΩXÔøΩÃï\ÔøΩÔøΩ
   183                                  		;---------------------------------------
   184 00000670 6A046A106A0468-         		cdecl	itoa, word [FONT.seg], .p1, 4, 16, 0b0100
   184 00000677 [F806]FF36[0002]E8-
   184 0000067E 8CFB83C40A         
   185 00000683 6A046A106A0468-         		cdecl	itoa, word [FONT.off], .p2, 4, 16, 0b0100
   185 0000068A [FD06]FF36[0202]E8-
   185 00000691 79FB83C40A         
   186 00000696 68[EA06]E824FA83C4-     		cdecl	puts, .s1
   186 0000069E 02                 
   187                                  
   188                                  		;---------------------------------------
   189                                  		; ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÃéÊìæÔøΩ∆ï\ÔøΩÔøΩ
   190                                  		;---------------------------------------
   191 0000069F E84BFC                  		cdecl	get_mem_info					; get_mem_info();
   192                                  
   193 000006A2 66A1[0402]              		mov		eax, [ACPI_DATA.adr]			; EAX = ACPI_DATA.adr;
   194 000006A6 6683F800                		cmp		eax, 0							; if (EAX)
   195 000006AA 742D                    		je		.10E							; {
   196                                  
   197 000006AC 6A046A106A0468-         		cdecl	itoa, ax, .p4, 4, 16, 0b0100	;   itoa(AX); // ÔøΩÔøΩÔøΩ ÉAÔøΩhÔøΩÔøΩÔøΩXÔøΩÔøΩœäÔøΩ
   197 000006B3 [1607]50E853FB83C4-
   197 000006BB 0A                 
   198 000006BC 66C1E810                		shr		eax, 16							;   EAX >>= 16;
   199 000006C0 6A046A106A0468-         		cdecl	itoa, ax, .p3, 4, 16, 0b0100	;   itoa(AX); // ÔøΩÔøΩ ÉAÔøΩhÔøΩÔøΩÔøΩXÔøΩÔøΩœäÔøΩ
   199 000006C7 [1207]50E83FFB83C4-
   199 000006CF 0A                 
   200                                  
   201 000006D0 68[0707]E8EAF983C4-     		cdecl	puts, .s2						;   puts(.s2); // ÔøΩAÔøΩhÔøΩÔøΩÔøΩXÔøΩÔøΩ\ÔøΩÔøΩ
   201 000006D8 02                 
   202                                  .10E:											; }
   203                                  
   204                                  		;---------------------------------------
   205                                  		; ÔøΩÔøΩÔøΩÔøΩÔøΩÃèIÔøΩÔøΩ
   206                                  		;---------------------------------------
   207 000006D9 EBFE                    		jmp		$								; while (1) ; // ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ[ÔøΩv
   208                                  
   209                                  		;---------------------------------------
   210                                  		; ÔøΩfÔøΩ[ÔøΩ^
   211                                  		;---------------------------------------
   212 000006DB 337264207374616765-     .s0:	db	"3rd stage...", 0x0A, 0x0D, 0
   212 000006E4 2E2E2E0A0D00       
   213                                  
   214 000006EA 20466F6E7420416464-     .s1:	db	" Font Address="
   214 000006F3 726573733D         
   215 000006F8 5A5A5A5A3A              .p1:	db	"ZZZZ:"
   216 000006FD 5A5A5A5A0A0D00          .p2:	db	"ZZZZ", 0x0A, 0x0D, 0
   217 00000704 0A0D00                  		db	0x0A, 0x0D, 0
   218                                  
   219 00000707 204143504920646174-     .s2:	db	" ACPI data="
   219 00000710 613D               
   220 00000712 5A5A5A5A                .p3:	db	"ZZZZ"
   221 00000716 5A5A5A5A0A0D00          .p4:	db	"ZZZZ", 0x0A, 0x0D, 0
   222                                  
   223                                  ;************************************************************************
   224                                  ;	ÔøΩpÔøΩfÔøΩBÔøΩÔøΩÔøΩO
   225                                  ;************************************************************************
   226 0000071D 00<rep 18E3h>           		times BOOT_SIZE - ($ - $$)		db	0	; ÔøΩpÔøΩfÔøΩBÔøΩÔøΩÔøΩO
   227                                  
